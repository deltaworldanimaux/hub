<!DOCTYPE html>
<html>
<head>
  <title>Online Stores Hub</title>
  <style>
    .store { padding: 15px; border: 1px solid #ddd; margin: 10px; cursor: pointer; }
    .products { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; }
    .product-card { border: 1px solid #eee; padding: 10px; text-align: center; }
  </style>
</head>
<body>
  <h1>Available Stores</h1>
  <div id="stores-container"></div>
  
  <div id="products-container" style="display:none;">
    <button onclick="showStores()">‚Üê Back to Stores</button>
    <h2 id="store-title"></h2>
    <div class="products"></div>
  </div>

  <script>
    const HUB_URL = "https://362c5d06-d1be-432a-b361-36250802f590-00-vzq2xn38kwt1.kirk.replit.dev/";
    let currentStoreId = null;

    async function loadStores() {
      const res = await fetch(`${HUB_URL}/stores`);
      const stores = await res.json();
      
      const container = document.getElementById('stores-container');
      container.innerHTML = '';
      
      stores.forEach(store => {
        const storeEl = document.createElement('div');
        storeEl.className = 'store';
        storeEl.innerHTML = `<h3>${store.storeName}</h3>`;
        storeEl.onclick = () => showProducts(store.storeId, store.storeName);
        container.appendChild(storeEl);
      });
    }

    async function showProducts(storeId, storeName) {
      currentStoreId = storeId;
      document.getElementById('store-title').textContent = storeName;
      document.getElementById('stores-container').style.display = 'none';
      document.getElementById('products-container').style.display = 'block';
      
      const res = await fetch(`${HUB_URL}/products/${storeId}`);
      const products = await res.json();
      
      const container = document.querySelector('#products-container .products');
      container.innerHTML = '';
      
      products.forEach(product => {
        const card = document.createElement('div');
        card.className = 'product-card';
        card.innerHTML = `
          <h4>${product.name}</h4>
          <p>${product.price} DH/${product.type}</p>
          <button onclick="orderProduct('${product.id}')">Order</button>
        `;
        container.appendChild(card);
      });
    }

    async function orderProduct(productId) {
      const order = {
        id: `ORD-${Date.now()}`,
        productId,
        date: new Date().toISOString(),
        status: 'pending'
      };
      
      await fetch(`${HUB_URL}/orders/${currentStoreId}`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(order)
      });
      
      alert('Order placed successfully!');
    }

    function showStores() {
      document.getElementById('products-container').style.display = 'none';
      document.getElementById('stores-container').style.display = 'block';
    }

    // Initialize
    loadStores();
  </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Hub Test - Client</title>
</head>
<body>
  <h1>Client App - Test</h1>

  <label>Store ID: 
    <input type="text" id="storeId" value="store_ma1">
  </label>
  <button onclick="loadProducts()">Load Products</button>

  <h2>Products</h2>
  <ul id="products"></ul>

  <h2>Order</h2>
  <button onclick="placeOrder()">Place Test Order</button>

  <pre id="orderResult"></pre>

<script>
const HUB_URL = "https://362c5d06-d1be-432a-b361-36250802f590-00-vzq2xn38kwt1.kirk.replit.dev";

async function loadProducts() {
  const storeId = document.getElementById("storeId").value;
  try {
    const res = await fetch(`${HUB_URL}/products/${storeId}`);
    if (!res.ok) {
      throw new Error(`Failed to load products: ${res.status} ${res.statusText}`);
    }
    const products = await res.json();
    const container = document.getElementById("products");
    
    if (products.length === 0) {
      container.innerHTML = "<p>No products found</p>";
      return;
    }
    
    // Create table with product details
    let tableHTML = `
      <table>
        <thead>
          <tr>
            <th>Name</th>
            <th>Price (MAD)</th>
            <th>Available</th>
            <th>Type</th>
          </tr>
        </thead>
        <tbody>
    `;
    
    products.forEach(p => {
      tableHTML += `
        <tr>
          <td>${p.name}</td>
          <td>${p.price.toFixed(2)}</td>
          <td>${p.amount}</td>
          <td>${p.type}</td>
        </tr>
      `;
    });
    
    tableHTML += `
        </tbody>
      </table>
    `;
    
    container.innerHTML = tableHTML;
  } catch (error) {
    console.error("Error loading products:", error);
    document.getElementById("products").innerHTML = `<p class="error">Error: ${error.message}</p>`;
  }
}

async function placeOrder() {
  const storeId = document.getElementById("storeId").value;
  const order = {
    id: "ORD-" + Date.now(),
    client: "Test Client",
    items: [{ 
      id: "sample-item", 
      name: "Sample Item", 
      quantity: 1, 
      price: 10,
      type: "piece"
    }],
    date: new Date().toISOString()
  };

  try {
    const res = await fetch(`${HUB_URL}/orders/${storeId}`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(order)
    });
    
    if (!res.ok) {
      throw new Error(`Order failed: ${res.status} ${res.statusText}`);
    }
    
    const data = await res.json();
    document.getElementById("orderResult").textContent = JSON.stringify(data, null, 2);
  } catch (error) {
    console.error("Error placing order:", error);
    document.getElementById("orderResult").textContent = `Error: ${error.message}`;
  }
}
</script>
</body>
</html>